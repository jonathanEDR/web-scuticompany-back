# ========================================
# 游 RENDER BLUEPRINT - Web Scuti Backend
# ========================================
# Este archivo configura el despliegue en Render.com
# Documentaci칩n: https://render.com/docs/blueprint-spec
#
# Para usar este blueprint:
# 1. Conecta tu repo a Render
# 2. Render detectar치 autom치ticamente este archivo
# 3. O manualmente: Dashboard > Blueprints > New Blueprint Instance

services:
  # ========================================
  # 游깷 WEB SERVICE - Backend API
  # ========================================
  - type: web
    name: web-scuticompany-back
    runtime: node
    region: oregon  # Cambiar seg칰n tu preferencia (oregon, frankfurt, singapore, ohio)
    
    # ========================================
    # 游닍 BUILD & START
    # ========================================
    buildCommand: npm install
    startCommand: npm start
    
    # ========================================
    # 游댢 CONFIGURACI칍N DE INSTANCIA
    # ========================================
    plan: starter  # free, starter, standard, pro (ajustar seg칰n necesidades)
    numInstances: 1  # Aumentar a 2+ para alta disponibilidad
    
    # ========================================
    # 游눕 HEALTH CHECK (CR칈TICO para uptime)
    # ========================================
    healthCheckPath: /health
    # Render env칤a GET a /health cada pocos segundos
    # Si falla 15 segundos seguidos, deja de enviar tr치fico
    # Si falla 60 segundos seguidos, reinicia el servicio
    
    # ========================================
    # 游깴 VARIABLES DE ENTORNO
    # ========================================
    envVars:
      - key: NODE_ENV
        value: production
      
      - key: PORT
        value: 10000  # Puerto por defecto de Render
      
      # 丘멆잺 SECRETOS - Configurar en Dashboard de Render
      # No incluir valores reales aqu칤
      - key: MONGODB_URI
        sync: false  # Configurar manualmente en dashboard
      
      - key: CLERK_SECRET_KEY
        sync: false
      
      - key: CLERK_PUBLISHABLE_KEY
        sync: false
      
      - key: CLOUDINARY_CLOUD_NAME
        sync: false
      
      - key: CLOUDINARY_API_KEY
        sync: false
      
      - key: CLOUDINARY_API_SECRET
        sync: false
      
      - key: OPENAI_API_KEY
        sync: false
      
      - key: RESEND_API_KEY
        sync: false
      
      - key: FRONTEND_URL
        sync: false  # Ejemplo: https://web-scuticompany.vercel.app

# ========================================
# 游닇 NOTAS DE DESPLIEGUE
# ========================================
# 
# 1. HEALTH CHECK:
#    - El endpoint /health retorna 200 solo cuando el servidor est치 listo
#    - Verifica conexi칩n a MongoDB antes de retornar OK
#    - Render usa esto para zero-downtime deploys
#
# 2. GRACEFUL SHUTDOWN:
#    - El servidor maneja SIGTERM correctamente
#    - Cierra conexiones MongoDB antes de terminar
#    - Timeout de 25s para completar cierre
#
# 3. M칔LTIPLES INSTANCIAS (Recomendado para producci칩n):
#    - Cambiar numInstances a 2 o m치s
#    - Render distribuye entre diferentes nodos
#    - Si una instancia falla, las otras siguen funcionando
#
# 4. MONITOREO EXTERNO (Opcional pero recomendado):
#    - Configurar probe externo (HeyOnCall, Better Stack)
#    - Monitorea desde fuera de Render
#    - Notificaciones m치s r치pidas de ca칤das
#
# 5. LOGS:
#    - El servidor loggea CF-Ray ID para debugging
#    - Ver logs en: Dashboard > Service > Logs
#
